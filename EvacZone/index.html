<!DOCTYPE html>
<html>
<head>
    <title>Evacuation Zone Helper</title>
	<meta charset="utf-8" />
  <script src="Scripts/jquery-1.9.1.min.js"></script>
  <link href="Content/bootstrap.min.css" rel="stylesheet" />
  <link href="Content/bootstrap-theme.min.css" rel="stylesheet" />
</head>
<body class="container">
  <div class="headerBox container bg-info">
    <h3>
      Evacuation Zone Helper
    </h3>
    <p>
      You can use this application to find if a given address is in an Evacuation Zone. 
      Please type in the house number, and part of the street name to search.
    </p>
  </div>

    <div style="margin-top: 1em;"
         class="form-group row">
      <label class="control-label col-sm-2"
             for="house">House Number</label>
      <div class="col-sm-10">
        <input type="number"
               class="form-control"
               required
               placeholder="House Number"
               id="house" />
      </div>
    </div>
    <div class="form-group row">
      <label class="control-label col-sm-2"
             for="street">Street Name</label>
      <div class="col-sm-10">
        <input type="text"
               required
               class="form-control"
               placeholder="Street Name"
               maxlength="25"
               id="street" />
      </div>
    </div>
    <span style="display: none;"
          class="alert alert-danger row"
          role="alert"
          id="Error">

    </span>
    <div class="row">
      <button
             id="btnSearch"
             onclick="return Search(event); return false;"
             class="col-sm-offset-2 btn btn-primary btn-lg">
      Search
        </button>
    </div>
    <div style="display: none;"
         class="container"
         id="results">

    </div>
  <script type="text/javascript">
    function Search(ev) {
      ev.preventDefault();
      var e = document.getElementById('Error');
      e.innerText = "";
      e.style.display = "none";

      if (!Validate()) {
        e.innerText = "Please check the values entered and try again.  The house number must be a number, and the street must not contain numbers."
        e.style.display = "block";
        console.log(e.innerText);
        return;
      }
      var SearchAddress = {
        house: document.getElementById('house').value,
        street: document.getElementById('street').value.toUpperCase()
      }
      
      console.log("true", SearchAddress);
      $.post(
        './API/Evac/',
        SearchAddress,
        Success,
        'json');
      return true;
    }
    function Success(data, status, jqxhr) {
      
      console.log('success', data);
      BuildResults(data);
    }
    function Validate() {
      var housenumber = document.getElementById('house').value;
      var street = document.getElementById('street').value;
      console.log(housenumber, street);
      return (housenumber.length > 0 && street.length > 0)
    }

    function BuildResults(data) {
      var target = document.getElementById('results');
      target.innerHTML = "";
      var table = document.createElement("table");
      table.classList.add("table", "table-striped");
      table.appendChild(BuildTableHeaderRow());
      var tbody = document.createElement("tbody");
      if (data.length == 0) {
        var row = document.createElement("tr");
        var cell = document.createElement("td");
        cell.colSpan = 4;
        cell.appendChild(document.createTextNode("No data was found for this search."));
        row.appendChild(cell);
        tbody.appendChild(row);
      }
      else {
        data.map(function (d) {
          var row = BuildTableRow(
            d.EvacZone,
            d.WholeAddress,
            d.City,
            d.Zip,
            false);
          tbody.appendChild(row);
        });
      }
      table.appendChild(tbody);
      target.appendChild(table);
      target.style.display = "block";
    }

    function BuildTableHeaderRow()
      {
        let thead = document.createElement("thead");
        let row = BuildTableRow("Evac Zone", "Whole Address", "City",
          "Zip", true);
        thead.appendChild(row);
        return thead;
      }

      function BuildTableRow(
        zone,
        address,
        city,
        zip,
        isHeader)
        {
          var row = document.createElement("tr");
          var colTag = (isHeader ? "TH" : "TD");
          row.appendChild(createTableElement(zone, "15%", colTag));
          row.appendChild(createTableElement(address, "45%", colTag));
          row.appendChild(createTableElement(city, "25%", colTag));
          row.appendChild(createTableElement(zip, "15%", colTag));
          return row;
      }

      function createTableElement(value, width, colTag) {
        var d = document.createElement(colTag);
        d.style.width = width;
        d.appendChild(document.createTextNode(value));
        return d;
      }

  </script>
</body>
</html>
